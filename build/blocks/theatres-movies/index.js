(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};window.wp.i18n;const t=window.wp.blocks,n=JSON.parse('{"UU":"anam-gutenberg-starter-block/theatres-movies"}');function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function o(e,t,n){return(t=function(e){var t=function(e){if("object"!=r(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==r(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,s=[],c=!0,l=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(e){l=!0,o=e}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw o}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return i(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}const s=window.React,c=window.wp.data,l=window.wp.blockEditor,u=window.wp.components;function d(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function h(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){d(i,r,o,a,s,"next",e)}function s(e){d(i,r,o,a,s,"throw",e)}a(void 0)}))}}const f=window.regeneratorRuntime;var p=e.n(f);const v=function(){var e=h(p().mark((function e(){var t,n,r,o,i=arguments;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:"",n={method:"GET",headers:{accept:"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiI5NDQxMzQ5MmRiNWUyZTRjYTVlOTM0MDJjYTYyM2ZjYSIsIm5iZiI6MTcxOTIwNzU0OC45NzY5OCwic3ViIjoiNjY3OTA0YWNlZmRiOGMxNzc0MGI1MmZkIiwic2NvcGVzIjpbImFwaV9yZWFkIl0sInZlcnNpb24iOjF9.3LtMcOLpN8GfR8UiFDFPUYYHJVft69TrEzPssuTqnBA"}},e.next=4,fetch(t,n);case 4:return r=e.sent,e.next=7,r.json();case 7:if(!1!==(o=e.sent).success){e.next=10;break}throw new Error(o.status_message);case 10:return e.abrupt("return",o);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),m=window.ReactJSXRuntime;function g(e){var t=e.attributes,n=e.setAttributes,r=e.movieAttributeKey,i=e.movieAPIUrl,c=e.fnHandleMovieUpdateForView,l=a((0,s.useState)(!1),2),d=l[0],h=l[1],f=a((0,s.useState)(!1),2),p=f[0],g=f[1],b=a((0,s.useState)(!1),2),j=b[0],y=b[1],w=a((0,s.useState)([]),2),x=w[0],O=w[1],S=a((0,s.useState)(""),2),C=S[0],N=S[1],k=t.fetchedMovies,P=[];return k.forEach((function(e){P.push(e.id)})),(0,m.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:[(0,m.jsx)(u.Button,{onClick:function(){return function(e,t,n){h(!0);var r=e.fetchedMovies,o=[],i=[];v(n).then((function(e){(o=e.results).forEach((function(e){P.includes(e.id)||i.push(e.id)})),JSON.stringify(o)!==JSON.stringify(r)||i.length>0?(y(!0),N("New movies available")):(y(!1),N("No new movies available")),h(!1),O(o)})).catch((function(e){return console.log(e)}))}(t,0,i)},variant:"primary",children:d?"Loading":"Check for Update"}),(0,m.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:[(0,m.jsx)("span",{style:{color:j?"green":"black"},children:C}),j&&(0,m.jsx)(u.Button,{variant:"secondary",onClick:function(){g(!0),n(o({},r,x)),c(x),setTimeout((function(){g(!1),N("Movies updated successfully"),y(!1)}),5e3)},children:p?"Updating":"Update"})]})]})}function b(e){var t=e.props,n=e.handleMovieUpdateForView,r=t.attributes,o=t.setAttributes,i=function(){return(0,m.jsx)(u.GradientPicker,{value:r.cardGradient,onChange:function(e){return o({cardGradient:e})},gradients:[{name:"Black White",gradient:"linear-gradient(180deg,rgba(255, 255, 255, 0) 0%,rgba(0, 0, 0, 0.6) 100%)",slug:"jshine"},{name:"Moonlit Asteroid",gradient:"linear-gradient(180deg,#0F202700 0%, #2c5364 100%)",slug:"moonlit-asteroid"},{name:"Rastafarie",gradient:"linear-gradient(180deg,#1E960000 0%, #FFF200 0%, #FF0000 100%)",slug:"rastafari"}]})};return(0,m.jsxs)("div",{children:[(0,m.jsxs)(l.InspectorControls,{children:[(0,m.jsx)(u.Panel,{children:(0,m.jsx)(u.PanelBody,{initialOpen:!0,title:"Update",children:(0,m.jsx)(u.PanelRow,{children:(0,m.jsx)(g,{attributes:r,setAttributes:o,movieAttributeKey:"fetchedMovies",movieAPIUrl:"https://api.themoviedb.org/3/movie/now_playing?language=en-US&page=1",fnHandleMovieUpdateForView:n})})})}),(0,m.jsx)(u.Panel,{children:(0,m.jsx)(u.PanelBody,{initialOpen:!0,title:"Block Structure",children:(0,m.jsx)(u.SelectControl,{label:"Choose Column",value:r.movieColumn,options:[{label:"Column 2",value:2},{label:"Column 3",value:3},{label:"Column 4",value:4}],onChange:function(e){o({movieColumn:+e})}})})}),(0,m.jsx)(u.Panel,{children:(0,m.jsxs)(u.PanelBody,{initialOpen:!0,title:"Meta Information",children:[(0,m.jsx)(u.CheckboxControl,{label:"Description",help:"Show description of the movie in the card.",checked:r.showDescription,onChange:function(e){o({showDescription:e})}}),(0,m.jsx)(u.CheckboxControl,{label:"Genre",help:"Show genre of the movie in the card.",checked:r.showGenre,onChange:function(e){o({showGenre:e})}}),(0,m.jsx)(u.CheckboxControl,{label:"Language",help:"Show Language of the movie in the card.",checked:r.showLanguage,onChange:function(e){o({showLanguage:e})}}),(0,m.jsx)(u.CheckboxControl,{label:"Release Date",help:"Show release date of the movie in the card.",checked:r.showReleaseDate,onChange:function(e){o({showReleaseDate:e})}}),(0,m.jsx)(u.CheckboxControl,{label:"Vote Count",help:"Show vote count of the movie in the card.",checked:r.showVoteCount,onChange:function(e){o({showVoteCount:e})}}),(0,m.jsx)(u.CheckboxControl,{label:"Vote Average",help:"Show vote average of the movie in the card.",checked:r.showVoteAverage,onChange:function(e){o({showVoteAverage:e})}})]})})]}),(0,m.jsx)(l.InspectorControls,{group:"styles",children:(0,m.jsx)(u.Panel,{children:(0,m.jsx)(u.PanelBody,{initialOpen:!0,title:"Gradient",children:(0,m.jsx)(i,{})})})})]})}const j=window.wp.element;var y=function(e){var t=e.genreIDArr,n=e.attributes.genres.filter((function(e){return t.includes(e.id)}));return(0,m.jsx)("ul",{children:n.map((function(e){return(0,m.jsx)("li",{children:e.name},e.id)}))})};const w=function(e){var t,n,r,o,i=e.movie,a=e.attributes;return(0,m.jsxs)("div",{className:"card","data-movieId":i.id,children:[(0,m.jsxs)("div",{className:"card__image",children:[(0,m.jsx)("img",{src:"https://image.tmdb.org/t/p/w500".concat(i.poster_path),alt:i.title}),(0,m.jsxs)("div",{className:"rating-point",children:[a.showVoteAverage&&(0,m.jsx)("span",{className:"vote-point",children:(r=i.vote_average,o=Math.pow(10,1),Math.round(r*o)/o)}),a.showVoteCount&&(0,m.jsx)("span",{className:"vote-count",children:i.vote_count})]}),(0,m.jsxs)("div",{className:"language-and-yeaer",children:[a.showLanguage&&(0,m.jsx)("span",{className:"language",children:i.original_language}),a.showReleaseDate&&(0,m.jsx)("span",{className:"year",children:(t=i.release_date,n=Date.parse(t),new Date(n).getFullYear())})]})]}),(0,m.jsx)("div",{className:"card__header",children:(0,m.jsx)("h2",{children:i.title})}),a.showDescription&&(0,m.jsx)("div",{className:"card__body",children:(0,m.jsx)("p",{children:i.overview})}),(0,m.jsx)("div",{className:"card__footer",children:a.showGenre&&(0,m.jsx)("div",{className:"genre",children:(0,m.jsx)(y,{genreIDArr:i.genre_ids,attributes:a})})})]})};function x(){return(0,m.jsxs)("div",{id:"popup-modal-for-movie-card",style:{display:"none"},children:[(0,m.jsx)("div",{id:"close-modal",children:"close"}),(0,m.jsx)("div",{id:"fetched-movie-content"})]})}const O=function(){var e=h(p().mark((function e(){var t,n,r,o,i=arguments;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:"",n={method:"GET",headers:{accept:"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiI5NDQxMzQ5MmRiNWUyZTRjYTVlOTM0MDJjYTYyM2ZjYSIsIm5iZiI6MTcxOTIwNzU0OC45NzY5OCwic3ViIjoiNjY3OTA0YWNlZmRiOGMxNzc0MGI1MmZkIiwic2NvcGVzIjpbImFwaV9yZWFkIl0sInZlcnNpb24iOjF9.3LtMcOLpN8GfR8UiFDFPUYYHJVft69TrEzPssuTqnBA"}},e.next=4,fetch(t,n);case 4:return r=e.sent,e.next=7,r.json();case 7:if(!1!==(o=e.sent).success){e.next=10;break}throw new Error(o.status_message);case 10:return e.abrupt("return",o);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();function S(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function C(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?S(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function N(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function k(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?N(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}(0,t.registerBlockType)(n.UU,{edit:function(e){var t=(0,l.useBlockProps)({className:"gs-theatres-movie-block"}),n=e.name;if(!n)return null;var r=n.split("/")[1],o=(0,c.useSelect)((function(e){return e("core/editor").getCurrentPostId()})),i=e.attributes,s=e.setAttributes,u=a((0,j.useState)(!1),2),d=(u[0],u[1],a((0,j.useState)([]),2)),h=d[0],f=d[1],p=a((0,j.useState)((function(){var e=localStorage.getItem("meta_status_".concat(o));return e?JSON.parse(e):null})),2),v=p[0],g=p[1];return(0,j.useEffect)((function(){o&&(v&&200===v.status||fetch("".concat("/wp-json/anam-gutenberg-starter-block/v1/add-meta","/").concat(o),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({blockSlug:r})}).then((function(e){if(console.log(e),!e.ok)throw new Error("HTTP error! Status: ".concat(e.status));return e.json()})).then((function(e){200===e.status&&(g(e),localStorage.setItem("meta_status_".concat(o),JSON.stringify(e)))})).catch((function(e){console.error("Error adding meta:",e)})))}),[o]),(0,j.useEffect)((function(){i.genres.length<1&&O("https://api.themoviedb.org/3/genre/movie/list?language=en").then((function(e){s({genres:e.genres})})).catch((function(e){return console.log("genre err",e)})),i.fetchedMovies.length>0&&f(i.fetchedMovies),i.fetchedMovies.length<1&&O("https://api.themoviedb.org/3/movie/now_playing?language=en-US&page=1").then((function(e){f(e.results),s({fetchedMovies:e.results})})).catch((function(e){return console.log("err",e)}))}),[]),(0,m.jsxs)("div",C(C({},t),{},{children:[(0,m.jsx)(b,{props:e,handleMovieUpdateForView:function(e){f(e),s({fetchedMovies:e}),console.log("newMovies",e)}}),(0,m.jsx)(x,{}),(0,m.jsx)("div",{id:"theatres-movies-block",className:"movie-list theatres-movies-block",style:{gridTemplateColumns:"repeat(\n\t\t\t\t\t\t".concat(i.movieColumn,", 1fr\n\t\t\t\t\t)")},children:h&&h.map((function(e){return(0,m.jsx)(w,{movie:e,attributes:i},e.id)}))})]}))},save:function(e){var t=e.attributes,n=l.useBlockProps.save({className:"gs-theatres-movie-block"}),r=t.fetchedMovies;return(0,m.jsxs)("div",k(k({},n),{},{children:[(0,m.jsx)(x,{}),(0,m.jsx)("div",{id:"theatres-movies-block",className:"movie-list theatres-movies-block",style:{gridTemplateColumns:"repeat(\n\t\t\t\t\t\t".concat(t.movieColumn,", 1fr\n\t\t\t\t\t)")},children:r&&r.map((function(e){return(0,m.jsx)(w,{movie:e,attributes:t},e.id)}))})]}))}})})();